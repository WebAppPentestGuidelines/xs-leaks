<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Document Policies"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://xsleaks.dev/defenses/document-policies/"><title>Document Policies | XS-Leaks Wiki</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.1c9a9009be3c645cbccbe64eb0a90e28621e4118971d9a502db4aaa9bec96cfc.css integrity="sha256-HJqQCb48ZFy8y+ZOsKkOKGIeQRiXHZpQLbSqqb7JbPw="><script defer src=/en.search.min.191ebcb00d5c065f5f76aacb6507e71d1fe649eb2858975535f0380f4e272c40.js integrity="sha256-GR68sA1cBl9fdqrLZQfnHR/mSesoWJdVNfA4D04nLEA="></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script>
<link rel=alternate type=application/rss+xml href=https://xsleaks.dev/defenses/document-policies/index.xml title="XS-Leaks Wiki"></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>攻撃手法</span><ul><li><a href=/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/docs/attacks/window-references/>Window References</a></li><li><a href=/docs/attacks/css-tricks/>CSS Tricks</a></li><li><a href=/docs/attacks/error-events/>Error Events</a></li><li><a href=/docs/attacks/frame-counting/>Frame Counting</a></li><li><a href=/docs/attacks/navigations/>Navigations</a></li><li><a href=/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/docs/attacks/element-leaks/>Element leaks</a></li><li><a href=/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/docs/attacks/timing-attacks/performance-api/>Performance API</a></li><li><a href=/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/docs/attacks/css-injection/>CSS Injection</a></li><li><a href=/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/docs/defenses/>対策の仕組み</a><ul><li><a href=/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li><li><a href=/docs/defenses/opt-in/document-policies/>Document Policies</a></li></ul></li><li><a href=/docs/defenses/isolation-policies/>Isolation Policies</a><ul><li><a href=/docs/defenses/isolation-policies/resource-isolation/>Resource Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/framing-isolation/>Framing Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/navigation-isolation/>Navigation Isolation Policy</a></li><li><a href=/docs/defenses/isolation-policies/strict-isolation/>Strict Isolation Policy</a></li></ul></li><li><a href=/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li><li class=book-section-flat><a href=/docs/contributions/>Contributions</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Document Policies</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Abuse</strong><ul><li class="flex justify-between"><a href=/abuse/window-references/>Window References</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/browser-feature/>Browser Feature</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/browser-limits/>Browser Limits</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/connection-pool/>Connection Pool</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/content-type/>Content-Type</a>
<span>3</span></li><li class="flex justify-between"><a href=/abuse/csp-violations/>CSP Violations</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/css/>CSS</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/css-injections/>CSS Injections</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/downloads/>Downloads</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/error-events/>Error Events</a>
<span>3</span></li><li class="flex justify-between"><a href=/abuse/event-loop/>Event Loop</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/focus/>focus</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/history/>History</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/iframes/>iframes</a>
<span>9</span></li><li class="flex justify-between"><a href=/abuse/nosniff/>nosniff</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/onblur/>onblur</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/postmessage/>postMessage</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/redirects/>Redirects</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/regex-injections/>Regex Injections</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/service-workers/>Service Workers</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/site-isolation/>Site Isolation</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/status-code/>Status Code</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/typemustmatch/>typeMustMatch</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/window.open/>window.open</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/window.performance/>window.performance</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/window.stop/>window.stop</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/abortcontroller/>AbortController</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/cache/>Cache</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/htmlelement/>HTMLElement</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Category</strong><ul><li class="flex justify-between"><a href=/category/defense/>Defense</a>
<span>14</span></li><li class="flex justify-between"><a href=/category/attack/>Attack</a>
<span>18</span></li><li class="flex justify-between"><a href=/category/attack-principle/>Attack Principle</a>
<span>1</span></li><li class="flex justify-between"><a href=/category/experiments/>Experiments</a>
<span>2</span></li><li class="flex justify-between"><a href=/category/historical/>Historical</a>
<span>2</span></li><li class="flex justify-between"><a href=/category/instrument/>Instrument</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Defenses</strong><ul><li class="flex justify-between"><a href=/defenses/coop/>COOP</a>
<span>6</span></li><li class="flex justify-between"><a href=/defenses/fetch-metadata/>Fetch Metadata</a>
<span>12</span></li><li class="flex justify-between"><a href=/defenses/samesite-cookies/>SameSite Cookies</a>
<span>15</span></li><li class="flex justify-between"><a href=/defenses/application-fix/>Application Fix</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/browser-fix/>Browser Fix</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/corb/>CORB</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/deprecation/>Deprecation</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/document-policies/>Document Policies</a>
<span>2</span></li><li class="flex justify-between"><a href=/defenses/framing-protections/>Framing Protections</a>
<span>6</span></li><li class="flex justify-between"><a href=/defenses/subresource-protections/>Subresource Protections</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/vary-sec-fetch-site/>Vary: Sec-Fetch-Site</a>
<span>1</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/docs/attacks/id-attribute/>ID Attribute</a></h2><h5>October 1, 2020</h5><div>Abuse
<a href=/abuse/onblur/>onblur</a>,
<a href=/abuse/focus/>focus</a>,
<a href=/abuse/iframes/>iframes</a></div><div>Category
<a href=/category/attack/>Attack</a></div><div>Defenses
<a href=/defenses/fetch-metadata/>Fetch Metadata</a>,
<a href=/defenses/samesite-cookies/>SameSite Cookies</a>,
<a href=/defenses/framing-protections/>Framing Protections</a>,
<a href=/defenses/document-policies/>Document Policies</a></div><p>id属性はHTML要素を識別するために広く利用されています。残念ながらクロスオリジンのウェブサイトでfocusイベントとURLフラグメントを利用することによって、ページのどこにid属性が与えられているかを決定することができます。例えば、https://example.com/foo#barが読み込まれると、ブラウザはid="bar"が与えられた要素までスクロールしようとします。これはクロスオリジンのサイトで定義したiframeでhttps://example.com/foo#barを読み込むことによって検出することができます。もし、 id="bar" を持つ要素がある場合は、 focus イベントが発生します。 focus イベントもまた同じ目的で使用することができます1。
いくつかのウェブアプリケーションはfocusable要素にid属性を設定しており、ユーザ情報の開示につながります。これらのid属性には、ユーザに直接関連する機密情報やユーザの状態（アカウントの状態）に関連する情報を含めることができます。
コード # 以下のコードは別のサイトからID属性を検出する例を示しています：
// onblurイベントをリッスン onblur = () => { alert('Focus was lost, so there is a focusable element with the specified ID'); } var ifr = document.createElement('iframe'); // ページに id="x" のフォーカス可能な要素がある場合、フォーカスを得ることができます。 // 例： &lt;input id="x" value="test" /> ifr.src = 'https://example.org/#x'; document.body.appendChild(ifr); info
上記の手法はFireFoxではうまく動作しない可能性があります。 攻撃シナリオ # id属性を利用した攻撃は以下のような物があります。
とある銀行がモバイルデバイスのセッションを認証するために短い数字のワンタイムPin(OTP)を生成することを許可しています。この銀行のページはクライアントにPINコードを表示するためのbutton要素のidにOTPコードそのものを使用していました。この挙動を悪用し、すべてのオプションをブルートフォースすることでOTPコードを窃取し、ユーザアカウントを侵害することができます。 とあるウェブアプリケーションが、プレミアムアカウントのステータスを持つユーザや、特定の性別のユーザである場合、あらかじめ定義されたidとHTML要素の組み合わせを利用します。攻撃者は、被害者のページに特定のidがあるかを検出し、被害者のアカウント情報を漏えいさせることができます。 対策 # Document Policies SameSite Cookies (Lax) COOP Framing Protections Isolation Policies ✔️ ✔️ ✔️ ❌ FIP 参考文献 # Leaking IDs using focus, link&#160;&#8617;&#xfe0e;</p></article><article class="markdown book-post"><h2><a href=/docs/attacks/experiments/scroll-to-text-fragment/>Scroll to Text Fragment</a></h2><h5>October 1, 2020</h5><div>Abuse
<a href=/abuse/onblur/>onblur</a>,
<a href=/abuse/focus/>focus</a>,
<a href=/abuse/iframes/>iframes</a></div><div>Category
<a href=/category/experiments/>Experiments</a></div><div>Defenses
<a href=/defenses/document-policies/>Document Policies</a></div><p>Scroll to Text Fragment (STTF) は、ユーザーがウェブページのテキストの任意の部分へのリンクを作成できるWebプラットフォームの新機能です。フラグメント#:~:text=は、ブラウザによって強調表示されてビューポートに取り込まれるテキストスニペットを運びます。この機能は、攻撃者がこの動作の発生を検出できることで、新しいXS-Leakをもたらします。この問題は、Scroll to CSS SelectorのXS-Leakに非常によく似ています。
期待される課題・議論される課題 # この機能の仕様に関する初期の議論では、単純な実装でいくつかのXS-Leakをもたらせることが示されました1。この仕様では、様々な攻撃シナリオ2が考慮されており、Googleの研究結果も同様です3。この機能を実装する際、ブラウザが注意すべきXS-Leakの可能性の1つは、以下の通りです。
攻撃者は、ページをiframeとして埋め込むことで、親ドキュメントのonblurイベントを聞くことによって、ページがテキストにスクロールされたかどうかを検出することができます。この方法は、ID Attribute XS-Leakと類似しています。このシナリオは、Chromeの実装4では、トップレベルのナビゲーションで発生するフラグメントナビゲーションのみを許可しているため、緩和されています。 現在の課題 # warning
これらのXS-Leaksは、ターゲットページに何らかのマークアップを注入する必要があります。 STTFの開発過程で、フラグメントナビゲーションを検出するための新しい攻撃やトリックが発見されました。そのうちのいくつかは今でも有効です。
攻撃者が制御するiframeを埋め込んだWebページでは、テキストへのスクロールが発生したかどうかを攻撃者が判断することができるかもしれません。これは、IntersectionObserverAPIを使用して行うことができます5 2 3。 ページがレイジーローディングで画像を含む場合、攻撃者は画像が[ブラウザにキャッシュ]cached in the browserされているかどうかをチェックすることで、画像を含むフラグメントナビゲーションが発生したかどうかを検出することができます。これは、レイジーローディングの画像は、ビューポートに表示されたときにのみ取得（およびキャッシュ）されるため、機能します。 important
Scroll to Text Fragmentは、Chromeでのみ利用可能です。仕様書ドラフトは現在検討中です。 info
Scroll to Text Fragment XS-Leaksでは、ページ上に1つの単語が存在するかどうかを観察し、ユーザーがページに対して何らかの操作（例：マウスクリック）を行った場合にのみ、攻撃者は一度に1ビットの情報を抽出することが可能です。 なぜ問題なのか？ # 攻撃者はSTTFを悪用して、Webページに表示されるユーザーの個人情報を漏えいさせることができます。
事例シナリオ # あるユーザが国民健康保険制度のWebサイトにログインしており、そこでユーザの過去の病気や健康問題についての情報にアクセスすることが可能でした。攻撃者はユーザーをそのページの一つに誘い込み、STTFを使用してユーザーの健康状態の詳細を推測できる可能性があります。例えば、ある病名で検索した際に、ページスクロールを検知すると、その病名が被害者の病気であることを知ることができます。
対策 # Document Policies SameSite Cookies (Lax) COOP Framing Protections Isolation Policies ✔️ ✔️ ❌ ✔️ RIP 🔗 NIP 参考文献 # Privacy concerns with proposal through inducing network requests, link&#160;&#8617;&#xfe0e;
<a href=/docs/attacks/experiments/scroll-to-text-fragment/>...</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav><ul><li class=book-section-flat><strong>Abuse</strong><ul><li class="flex justify-between"><a href=/abuse/window-references/>Window References</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/browser-feature/>Browser Feature</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/browser-limits/>Browser Limits</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/connection-pool/>Connection Pool</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/content-type/>Content-Type</a>
<span>3</span></li><li class="flex justify-between"><a href=/abuse/csp-violations/>CSP Violations</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/css/>CSS</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/css-injections/>CSS Injections</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/downloads/>Downloads</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/error-events/>Error Events</a>
<span>3</span></li><li class="flex justify-between"><a href=/abuse/event-loop/>Event Loop</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/focus/>focus</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/history/>History</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/iframes/>iframes</a>
<span>9</span></li><li class="flex justify-between"><a href=/abuse/nosniff/>nosniff</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/onblur/>onblur</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/postmessage/>postMessage</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/redirects/>Redirects</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/regex-injections/>Regex Injections</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/service-workers/>Service Workers</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/site-isolation/>Site Isolation</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/status-code/>Status Code</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/typemustmatch/>typeMustMatch</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/window.open/>window.open</a>
<span>2</span></li><li class="flex justify-between"><a href=/abuse/window.performance/>window.performance</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/window.stop/>window.stop</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/abortcontroller/>AbortController</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/cache/>Cache</a>
<span>1</span></li><li class="flex justify-between"><a href=/abuse/htmlelement/>HTMLElement</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Category</strong><ul><li class="flex justify-between"><a href=/category/defense/>Defense</a>
<span>14</span></li><li class="flex justify-between"><a href=/category/attack/>Attack</a>
<span>18</span></li><li class="flex justify-between"><a href=/category/attack-principle/>Attack Principle</a>
<span>1</span></li><li class="flex justify-between"><a href=/category/experiments/>Experiments</a>
<span>2</span></li><li class="flex justify-between"><a href=/category/historical/>Historical</a>
<span>2</span></li><li class="flex justify-between"><a href=/category/instrument/>Instrument</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Defenses</strong><ul><li class="flex justify-between"><a href=/defenses/coop/>COOP</a>
<span>6</span></li><li class="flex justify-between"><a href=/defenses/fetch-metadata/>Fetch Metadata</a>
<span>12</span></li><li class="flex justify-between"><a href=/defenses/samesite-cookies/>SameSite Cookies</a>
<span>15</span></li><li class="flex justify-between"><a href=/defenses/application-fix/>Application Fix</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/browser-fix/>Browser Fix</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/corb/>CORB</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/deprecation/>Deprecation</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/document-policies/>Document Policies</a>
<span>2</span></li><li class="flex justify-between"><a href=/defenses/framing-protections/>Framing Protections</a>
<span>6</span></li><li class="flex justify-between"><a href=/defenses/subresource-protections/>Subresource Protections</a>
<span>1</span></li><li class="flex justify-between"><a href=/defenses/vary-sec-fetch-site/>Vary: Sec-Fetch-Site</a>
<span>1</span></li></ul></li></ul></nav></aside></main></body></html>