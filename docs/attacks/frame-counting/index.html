<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ウィンドウの参照により、クロスオリジンのページが他のページのいくつかの属性にアクセスできます。 これらの参照は、iframeとwindow.openを使用または許可するときに利用可能となります。 この参照は、同一生成元ポリシーを尊重し続けるため、ウィンドウに関する（限定的な）情報を提供します。
アクセス可能な属性の1つは、ウィンドウ内のフレーム数を提供するwindow.lengthです。 この属性は、ページに関する貴重な情報を攻撃者に提供します。
Webサイトでは一般的にフレーム（またはiframes）を使用しますが、この選択は必ずしもセキュリティ上の問題を意味するわけではありません。 しかし、Webサイトがユーザの情報に応じてページのフレーム数を変更する場合があります。 例えば、GETパラメータと利用者のデータに応じてレイアウトを変えるようなページで起こりえます。 攻撃者は、異なるページで window.length の値を測定することにより、被害者に関する情報を推測することが可能かもしれません。
コード # 以下のコードは、クロスサイトのページにおけるフレーム数に関する情報にアクセスする方法を示しています。
// ウィンドウへの参照を取得する var win = window.open('https://example.org'); // ページが読み込まれるのを待つ setTimeout(() => { // 読み込まれたiframeの数を読み取る console.log(&#34;%d iframes detected&#34;, win.length); }, 2000); 攻撃の対策 # 場合によっては、異なるアプリケーション状態が同じ数のフレームを持つことで、攻撃者がそれらを区別できないようにすることができます。 ただし、ページの読み込み中にフレーム数を連続的に記録することで、攻撃者に情報をリークする可能性があるパターンを示す可能性もあります。
// ウィンドウへの参照を取得する var win = window.open(&#34;https://example.org&#34;); var pattern = []; // ループ内で、60ms間隔でiframeの数を登録する var recorder = setInterval(() => { pattern.push(win.length) }, 60); // 6秒後にループを解除する setTimeout(() => { clearInterval(recorder); console.log(&#34;The pattern is: %s&#34;, pattern.join(', ')); }, 6 * 1000); 事例 # フレームカウント攻撃の例としては、以下のようなものがあります。"><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Frame Counting"><meta property="og:description" content="ウィンドウの参照により、クロスオリジンのページが他のページのいくつかの属性にアクセスできます。 これらの参照は、iframeとwindow.openを使用または許可するときに利用可能となります。 この参照は、同一生成元ポリシーを尊重し続けるため、ウィンドウに関する（限定的な）情報を提供します。
アクセス可能な属性の1つは、ウィンドウ内のフレーム数を提供するwindow.lengthです。 この属性は、ページに関する貴重な情報を攻撃者に提供します。
Webサイトでは一般的にフレーム（またはiframes）を使用しますが、この選択は必ずしもセキュリティ上の問題を意味するわけではありません。 しかし、Webサイトがユーザの情報に応じてページのフレーム数を変更する場合があります。 例えば、GETパラメータと利用者のデータに応じてレイアウトを変えるようなページで起こりえます。 攻撃者は、異なるページで window.length の値を測定することにより、被害者に関する情報を推測することが可能かもしれません。
コード # 以下のコードは、クロスサイトのページにおけるフレーム数に関する情報にアクセスする方法を示しています。
// ウィンドウへの参照を取得する var win = window.open('https://example.org'); // ページが読み込まれるのを待つ setTimeout(() => { // 読み込まれたiframeの数を読み取る console.log(&#34;%d iframes detected&#34;, win.length); }, 2000); 攻撃の対策 # 場合によっては、異なるアプリケーション状態が同じ数のフレームを持つことで、攻撃者がそれらを区別できないようにすることができます。 ただし、ページの読み込み中にフレーム数を連続的に記録することで、攻撃者に情報をリークする可能性があるパターンを示す可能性もあります。
// ウィンドウへの参照を取得する var win = window.open(&#34;https://example.org&#34;); var pattern = []; // ループ内で、60ms間隔でiframeの数を登録する var recorder = setInterval(() => { pattern.push(win.length) }, 60); // 6秒後にループを解除する setTimeout(() => { clearInterval(recorder); console.log(&#34;The pattern is: %s&#34;, pattern.join(', ')); }, 6 * 1000); 事例 # フレームカウント攻撃の例としては、以下のようなものがあります。"><meta property="og:type" content="article"><meta property="og:url" content="https://webapppentestguidelines.github.io/xs-leaks/docs/attacks/frame-counting/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2020-10-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-14T21:03:18+09:00"><title>Frame Counting | XS-Leaks Wiki</title><link rel=manifest href=/xs-leaks/manifest.json><link rel=icon href=/xs-leaks/favicon.png type=image/x-icon><link rel=stylesheet href=/xs-leaks/book.min.1c9a9009be3c645cbccbe64eb0a90e28621e4118971d9a502db4aaa9bec96cfc.css integrity="sha256-HJqQCb48ZFy8y+ZOsKkOKGIeQRiXHZpQLbSqqb7JbPw="><script defer src=/xs-leaks/en.search.min.3f4d86752e03bee26096d0706d69248797644a7e5ae2f27bd2401b47568d3779.js integrity="sha256-P02GdS4DvuJgltBwbWkkh5dkSn5a4vJ70kAbR1aNN3k="></script>
<script defer src=/xs-leaks/sw.min.8fe20fa5c13f563a054a6d30584266c3ce999873dcc8c0008902c3c633a2d1b0.js integrity="sha256-j+IPpcE/VjoFSm0wWEJmw86ZmHPcyMAAiQLDxjOi0bA="></script></head><body><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><nav><h2 class=book-brand><a href=/xs-leaks><span>XS-Leaks Wiki</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>攻撃手法</span><ul><li><a href=/xs-leaks/docs/attacks/xs-search/>XS-Search</a></li><li><a href=/xs-leaks/docs/attacks/window-references/>Window References</a></li><li><a href=/xs-leaks/docs/attacks/css-tricks/>CSS Tricks</a></li><li><a href=/xs-leaks/docs/attacks/error-events/>Error Events</a></li><li><a href=/xs-leaks/docs/attacks/frame-counting/ class=active>Frame Counting</a></li><li><a href=/xs-leaks/docs/attacks/navigations/>Navigations</a></li><li><a href=/xs-leaks/docs/attacks/cache-probing/>Cache Probing</a></li><li><a href=/xs-leaks/docs/attacks/element-leaks/>Element leaks</a></li><li><a href=/xs-leaks/docs/attacks/id-attribute/>ID Attribute</a></li><li><a href=/xs-leaks/docs/attacks/postmessage-broadcasts/>postMessage Broadcasts</a></li><li><span>Browser Features</span><ul><li><a href=/xs-leaks/docs/attacks/browser-features/corb/>CORB Leaks</a></li><li><a href=/xs-leaks/docs/attacks/browser-features/corp/>CORP Leaks</a></li></ul></li><li><span>Timing Attacks</span><ul><li><a href=/xs-leaks/docs/attacks/timing-attacks/clocks/>Clocks</a></li><li><a href=/xs-leaks/docs/attacks/timing-attacks/network-timing/>Network Timing</a></li><li><a href=/xs-leaks/docs/attacks/timing-attacks/performance-api/>Performance API</a></li><li><a href=/xs-leaks/docs/attacks/timing-attacks/execution-timing/>Execution Timing</a></li><li><a href=/xs-leaks/docs/attacks/timing-attacks/hybrid-timing/>Hybrid Timing</a></li><li><a href=/xs-leaks/docs/attacks/timing-attacks/connection-pool/>Connection Pool</a></li></ul></li><li><a href=/xs-leaks/docs/attacks/experiments/ class=collapsed>Experiments</a></li><li><a href=/xs-leaks/docs/attacks/css-injection/>CSS Injection</a></li><li><a href=/xs-leaks/docs/attacks/historical/ class=collapsed>Historical</a></li></ul></li><li class=book-section-flat><a href=/xs-leaks/docs/defenses/>対策の仕組み</a><ul><li><a href=/xs-leaks/docs/defenses/design-protections/>Application Design</a><ul><li><a href=/xs-leaks/docs/defenses/design-protections/cache-protections/>Cache Protections</a></li><li><a href=/xs-leaks/docs/defenses/design-protections/subresource-protections/>Subresource Protections</a></li></ul></li><li><a href=/xs-leaks/docs/defenses/opt-in/>Opt-In Mechanisms</a><ul><li><a href=/xs-leaks/docs/defenses/opt-in/fetch-metadata/>Fetch Metadata</a></li><li><a href=/xs-leaks/docs/defenses/opt-in/coop/>Cross-Origin-Opener-Policy</a></li><li><a href=/xs-leaks/docs/defenses/opt-in/corp/>Cross-Origin-Resource-Policy</a></li><li><a href=/xs-leaks/docs/defenses/opt-in/xfo/>Framing Protections</a></li><li><a href=/xs-leaks/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies</a></li><li><a href=/xs-leaks/docs/defenses/opt-in/document-policies/>Document Policies</a></li></ul></li><li><a href=/xs-leaks/docs/defenses/isolation-policies/>Isolation Policies</a><ul><li><a href=/xs-leaks/docs/defenses/isolation-policies/resource-isolation/>Resource Isolation Policy</a></li><li><a href=/xs-leaks/docs/defenses/isolation-policies/framing-isolation/>Framing Isolation Policy</a></li><li><a href=/xs-leaks/docs/defenses/isolation-policies/navigation-isolation/>Navigation Isolation Policy</a></li><li><a href=/xs-leaks/docs/defenses/isolation-policies/strict-isolation/>Strict Isolation Policy</a></li></ul></li><li><a href=/xs-leaks/docs/defenses/secure-defaults/>Secure Defaults</a><ul><li><a href=/xs-leaks/docs/defenses/secure-defaults/corb/>Cross-Origin Read Blocking</a></li><li><a href=/xs-leaks/docs/defenses/secure-defaults/partitioned-cache/>Partitioned HTTP Cache</a></li></ul></li></ul></li><li class=book-section-flat><a href=/xs-leaks/docs/contributions/>Contributions</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/xs-leaks/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Frame Counting</strong>
<label for=toc-control><img src=/xs-leaks/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#コード>コード</a></li><li><a href=#攻撃の対策>攻撃の対策</a></li><li><a href=#事例>事例</a></li><li><a href=#対策>対策</a></li><li><a href=#実例>実例</a></li><li><a href=#参考文献>参考文献</a></li></ul></nav></aside></header><article class=markdown><h1>Frame Counting</h1><h5>October 1, 2020</h5><div>Abuse
<a href=/xs-leaks/abuse/iframes/>iframes</a></div><div>Category
<a href=/xs-leaks/category/attack/>Attack</a></div><div>Defenses
<a href=/xs-leaks/defenses/fetch-metadata/>Fetch Metadata</a>,
<a href=/xs-leaks/defenses/samesite-cookies/>SameSite Cookies</a>,
<a href=/xs-leaks/defenses/coop/>COOP</a>,
<a href=/xs-leaks/defenses/framing-protections/>Framing Protections</a></div><p><p>ウィンドウの参照により、クロスオリジンのページが他のページのいくつかの属性にアクセスできます。
これらの参照は、<code>iframe</code>と<code>window.open</code>を使用または許可するときに利用可能となります。
この参照は、同一生成元ポリシーを尊重し続けるため、ウィンドウに関する（限定的な）情報を提供します。</p><p>アクセス可能な属性の1つは、ウィンドウ内のフレーム数を提供する<code>window.length</code>です。
この属性は、ページに関する貴重な情報を攻撃者に提供します。</p><p>Webサイトでは一般的にフレーム（または<code>iframes</code>）を使用しますが、この選択は必ずしもセキュリティ上の問題を意味するわけではありません。
しかし、Webサイトがユーザの情報に応じてページのフレーム数を変更する場合があります。
例えば、<code>GET</code>パラメータと利用者のデータに応じてレイアウトを変えるようなページで起こりえます。
攻撃者は、異なるページで <code>window.length</code> の値を測定することにより、被害者に関する情報を推測することが可能かもしれません。</p><h2 id=コード>コード
<a class=anchor href=#%e3%82%b3%e3%83%bc%e3%83%89>#</a></h2><p>以下のコードは、クロスサイトのページにおけるフレーム数に関する情報にアクセスする方法を示しています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#6272a4>// ウィンドウへの参照を取得する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>var</span> win <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>window</span>.open(<span style=color:#f1fa8c>&#39;https://example.org&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// ページが読み込まれるのを待つ
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>  <span style=color:#6272a4>// 読み込まれたiframeの数を読み取る
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  console.log(<span style=color:#f1fa8c>&#34;%d iframes detected&#34;</span>, win.length);
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>2000</span>);
</span></span></code></pre></div><h2 id=攻撃の対策>攻撃の対策
<a class=anchor href=#%e6%94%bb%e6%92%83%e3%81%ae%e5%af%be%e7%ad%96>#</a></h2><p>場合によっては、異なるアプリケーション状態が同じ数のフレームを持つことで、攻撃者がそれらを区別できないようにすることができます。
ただし、ページの読み込み中にフレーム数を連続的に記録することで、攻撃者に情報をリークする可能性があるパターンを示す可能性もあります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#6272a4>// ウィンドウへの参照を取得する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>var</span> win <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>window</span>.open(<span style=color:#f1fa8c>&#34;https://example.org&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>var</span> pattern <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// ループ内で、60ms間隔でiframeの数を登録する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span><span style=color:#8be9fd;font-style:italic>var</span> recorder <span style=color:#ff79c6>=</span> setInterval(() =&gt; {
</span></span><span style=display:flex><span>  pattern.push(win.length)
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>60</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4>// 6秒後にループを解除する
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>setTimeout(() =&gt; {
</span></span><span style=display:flex><span>   clearInterval(recorder);
</span></span><span style=display:flex><span>   console.log(<span style=color:#f1fa8c>&#34;The pattern is: %s&#34;</span>, pattern.join(<span style=color:#f1fa8c>&#39;, &#39;</span>));
</span></span><span style=display:flex><span>}, <span style=color:#bd93f9>6</span> <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>1000</span>);
</span></span></code></pre></div><h2 id=事例>事例
<a class=anchor href=#%e4%ba%8b%e4%be%8b>#</a></h2><p>フレームカウント攻撃の例としては、以下のようなものがあります。</p><ul><li>あるWebサイトでは、ユーザが検索エンジンでユーザ情報を検索することができます。もしユーザの検索に対する結果があるかどうかによって、ページ構造の<code>iframe</code>の数が異なる場合に、攻撃者は<a href=https://webapppentestguidelines.github.io/xs-leaks/docs/attacks/xs-search/>XS-Search</a>の技術を利用して、秘密をリークさせることができるでしょう。</li><li>あるWebサイトでは、性別やその他の個人情報に基づいてユーザプロファイルページの構造が異なります。攻撃者は、ページを開いてフレームをカウントすることで、情報を簡単にリークさせることができるでしょう。</li></ul><h2 id=対策>対策
<a class=anchor href=#%e5%af%be%e7%ad%96>#</a></h2><table><thead><tr><th style=text-align:center>Attack Alternative</th><th style=text-align:center><a href=https://webapppentestguidelines.github.io/xs-leaks/docs/defenses/opt-in/same-site-cookies/>SameSite Cookies (Lax)</a></th><th style=text-align:center><a href=https://webapppentestguidelines.github.io/xs-leaks/docs/defenses/opt-in/coop/>COOP</a></th><th style=text-align:center><a href=https://webapppentestguidelines.github.io/xs-leaks/docs/defenses/opt-in/xfo/>Framing Protections</a></th><th style=text-align:center><a href=https://webapppentestguidelines.github.io/xs-leaks/docs/defenses/isolation-policies/>Isolation Policies</a></th></tr></thead><tbody><tr><td style=text-align:center>iframes</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center>✔️</td><td style=text-align:center><a href=https://webapppentestguidelines.github.io/xs-leaks/docs/defenses/isolation-policies/framing-isolation/>FIP</a></td></tr><tr><td style=text-align:center>windows</td><td style=text-align:center>❌</td><td style=text-align:center>✔️</td><td style=text-align:center>❌</td><td style=text-align:center><a href=https://webapppentestguidelines.github.io/xs-leaks/docs/defenses/isolation-policies/navigation-isolation/>NIP</a></td></tr></tbody></table><h2 id=実例>実例
<a class=anchor href=#%e5%ae%9f%e4%be%8b>#</a></h2><p>Facebookに報告された脆弱性では、この手法を利用することで、投稿に掲載された特定の内容、友人の宗教情報、写真の位置情報などのユーザに関する情報をリークするというものでした<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>。</p><h2 id=参考文献>参考文献
<a class=anchor href=#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae>#</a></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Patched Facebook Vulnerability Could Have Exposed Private Information About You and Your Friends. <a href=https://www.imperva.com/blog/facebook-privacy-bug/>link</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/WebAppPentestGuidelines/xs-leaks//commit/416c64be14fdca9f4c30b3e6cd46f018f24a45c6 title='Last modified by tigerszk | June 14, 2022' target=_blank rel=noopener><img src=/xs-leaks/svg/calendar.svg class=book-icon alt=Calendar>
<span>Last Modified: June 14, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/WebAppPentestGuidelines/xs-leaks//edit/master/content//docs/attacks/frame-counting.md target=_blank rel=noopener><img src=/xs-leaks/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this article</span></a></div></div></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><nav id=TableOfContents><ul><li><a href=#コード>コード</a></li><li><a href=#攻撃の対策>攻撃の対策</a></li><li><a href=#事例>事例</a></li><li><a href=#対策>対策</a></li><li><a href=#実例>実例</a></li><li><a href=#参考文献>参考文献</a></li></ul></nav></aside></main></body></html>